<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NotePad</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4361ee;
            --secondary: #7209b7;
            --light-bg: #f5f5f5;
            --light-text: #333333;
            --dark-bg: #1e1e1e;
            --dark-text: #f0f0f0;
            --highlight: #4cc9f0;
            --error: #e63946;
            --warning: #ffb703;
            --success: #2a9d8f;
            --notepad-bg: #fff9c4;
            --notepad-dark-bg: #3e3e30;
            --border-radius: 0px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }

        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--light-bg);
            color: var(--light-text);
            transition: var(--transition);
        }

        body.dark-mode {
            background-color: var(--dark-bg);
            color: var(--dark-text);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding: 0.5rem 1rem;
            background-color: #2b579a;
            color: white;
            border-radius: var(--border-radius);
        }

        body.dark-mode header {
            background-color: #1c3e6e;
        }

        .logo {
            font-size: 1.25rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .theme-toggle, .save-btn, .load-btn, .delete-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            color: white;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
        }

        .theme-toggle:hover, .save-btn:hover, .load-btn:hover, .delete-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .main-content {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            position: relative;
        }

        .editor-section {
            flex: 1;
            min-width: 0;
        }

        .editor-container {
            position: relative;
            border-radius: var(--border-radius);
            background-color: var(--notepad-bg);
            box-shadow: var(--box-shadow);
            transition: var(--transition);
            margin-bottom: 0.5rem;
            height: calc(100vh - 200px);
            min-height: 300px;
            border-left: 1px solid #ddd;
            border-top: 1px solid #ddd;
            border-right: 1px solid #bbb;
            border-bottom: 1px solid #bbb;
        }

        body.dark-mode .editor-container {
            background-color: var(--notepad-dark-bg);
            border-color: #444;
        }

        .editor {
            width: 100%;
            height: 100%;
            padding: 1rem;
            font-size: 1rem;
            line-height: 1.5;
            border: none;
            border-radius: var(--border-radius);
            outline: none;
            resize: none;
            background-color: transparent;
            color: var(--light-text);
            transition: var(--transition);
            box-sizing: border-box;
            font-family: 'Courier New', Courier, monospace;
        }

        body.dark-mode .editor {
            color: var(--dark-text);
        }

        .counts {
            display: flex;
            justify-content: space-between;
            font-size: 0.875rem;
            color: #666;
            margin-bottom: 0.5rem;
            padding: 0 0.5rem;
        }

        body.dark-mode .counts {
            color: #aaa;
        }

        /* Rolling Grammar Toolbar */
        .grammar-toolbar {
            position: absolute;
            right: -300px;
            top: 0;
            width: 300px;
            background-color: white;
            border-radius: 4px;
            box-shadow: var(--box-shadow);
            transition: right 0.3s ease;
            border: 1px solid #ddd;
            height: 100%;
            display: flex;
            flex-direction: column;
            z-index: 10;
        }

        .grammar-toolbar.open {
            right: 0;
        }

        body.dark-mode .grammar-toolbar {
            background-color: #2a2a2a;
            border-color: #444;
        }

        .grammar-toggle {
            position: absolute;
            left: -30px;
            top: 50%;
            transform: translateY(-50%);
            background-color: white;
            border: 1px solid #ddd;
            border-right: none;
            border-radius: 4px 0 0 4px;
            padding: 0.75rem 0.5rem;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: -2px 0 5px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode .grammar-toggle {
            background-color: #2a2a2a;
            border-color: #444;
            color: white;
        }

        .grammar-toggle-icon {
            font-size: 1.25rem;
            margin-bottom: 0.5rem;
        }

        .grammar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #eee;
        }

        body.dark-mode .grammar-header {
            border-color: #444;
        }

        .grammar-title {
            font-size: 1.125rem;
            font-weight: 600;
        }

        .grammar-score {
            background-color: var(--success);
            color: white;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: 700;
            font-size: 0.875rem;
        }

        .issue-list {
            overflow-y: auto;
            flex-grow: 1;
            padding: 0;
            margin: 0;
        }

        .issue-item {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid #eee;
            list-style: none;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .issue-item:hover {
            background-color: #f9f9f9;
        }

        body.dark-mode .issue-item {
            border-color: #444;
        }

        body.dark-mode .issue-item:hover {
            background-color: #333;
        }

        .issue-header {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .issue-icon {
            margin-right: 0.75rem;
            font-size: 0.875rem;
            color: var(--warning);
        }

        .issue-type {
            font-weight: 500;
            font-size: 0.875rem;
        }

        .issue-text {
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
            color: #666;
        }

        body.dark-mode .issue-text {
            color: #aaa;
        }

        .issue-suggestion {
            font-size: 0.875rem;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .issue-suggestion-text {
            font-weight: 500;
        }

        .apply-suggestion {
            background-color: var(--primary);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.25rem 0.5rem;
            cursor: pointer;
            font-size: 0.75rem;
        }

        .apply-suggestion:hover {
            background-color: #3651d8;
        }

        .highlight-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            padding: 1rem;
            white-space: pre-wrap;
            overflow: auto;
            font-size: 1rem;
            line-height: 1.5;
            color: transparent;
            box-sizing: border-box;
            font-family: 'Courier New', Courier, monospace;
        }

        .gpt-highlight {
            background-color: rgba(230, 57, 70, 0.2);
            border-bottom: 2px solid var(--error);
        }

        .grammar-highlight {
            background-color: rgba(255, 183, 3, 0.2);
            border-bottom: 2px solid var(--warning);
        }

        .popup {
            position: absolute;
            background-color: white;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
            max-width: 300px;
            z-index: 10;
            display: none;
            border: 1px solid #ddd;
        }

        body.dark-mode .popup {
            background-color: #2a2a2a;
            border-color: #444;
        }

        .popup-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--error);
        }

        .popup-content {
            line-height: 1.4;
        }

        .popup.visible {
            display: block;
        }

        .loading {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: var(--border-radius);
            z-index: 5;
        }

        body.dark-mode .loading {
            background-color: rgba(30, 30, 30, 0.8);
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
        }

        body.dark-mode .spinner {
            border-color: rgba(255, 255, 255, 0.1);
            border-top-color: var(--primary);
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .gpt-detection-section {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 1rem;
            transition: var(--transition);
            border: 1px solid #ddd;
        }

        body.dark-mode .gpt-detection-section {
            background-color: #2a2a2a;
            border-color: #444;
        }

        .gpt-detection-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .gpt-detection-title {
            font-size: 1rem;
            font-weight: 600;
        }

        .gpt-score-container {
            display: flex;
            align-items: center;
        }

        .gpt-progress {
            width: 100%;
            height: 8px;
            background-color: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.5rem;
        }

        body.dark-mode .gpt-progress {
            background-color: #444;
        }

        .gpt-progress-bar {
            height: 100%;
            background-color: var(--error);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .gpt-info {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: #666;
        }

        body.dark-mode .gpt-info {
            color: #aaa;
        }

        .gpt-high {
            color: var(--error);
        }

        .gpt-medium {
            color: var(--warning);
        }

        .gpt-low {
            color: var(--success);
        }

        /* Modal styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            display: none;
        }

        .modal {
            background-color: white;
            border-radius: 8px;
            padding: 1.5rem;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        body.dark-mode .modal {
            background-color: #2a2a2a;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        body.dark-mode .modal-close {
            color: #aaa;
        }

        .save-form, .load-form {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-label {
            font-size: 0.875rem;
            font-weight: 500;
        }

        .form-input {
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        body.dark-mode .form-input {
            background-color: #333;
            border-color: #444;
            color: white;
        }

        .saved-notes-list {
            margin: 0;
            padding: 0;
            max-height: 300px;
            overflow-y: auto;
        }

        .saved-note-item {
            list-style: none;
            padding: 0.75rem;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        body.dark-mode .saved-note-item {
            border-color: #444;
        }

        .saved-note-item:last-child {
            border-bottom: none;
        }

        .note-info {
            flex: 1;
        }

        .note-title {
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .note-date {
            font-size: 0.75rem;
            color: #666;
        }

        body.dark-mode .note-date {
            color: #aaa;
        }

        .note-actions {
            display: flex;
            gap: 0.5rem;
        }

        .load-note-btn, .delete-note-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.875rem;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
        }

        .load-note-btn {
            color: var(--primary);
        }

        .load-note-btn:hover {
            background-color: rgba(67, 97, 238, 0.1);
        }

        .delete-note-btn {
            color: var(--error);
        }

        .delete-note-btn:hover {
            background-color: rgba(230, 57, 70, 0.1);
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            font-size: 0.875rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: #3651d8;
        }

        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
        }

        .no-saved-notes {
            text-align: center;
            padding: 1rem;
            color: #666;
        }

        body.dark-mode .no-saved-notes {
            color: #aaa;
        }

        @media (max-width: 900px) {
            .grammar-toolbar {
                width: 260px;
            }
        }

        @media (max-width: 600px) {
            .grammar-toolbar {
                width: 100%;
                right: -100%;
            }

            .grammar-toggle {
                left: -40px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-sticky-note"></i>
                <span>NotePad</span>
            </div>
            <div class="header-actions">
                <button class="save-btn" id="saveBtn">
                    <i class="fas fa-save"></i>
                    <span>Save</span>
                </button>
                <button class="load-btn" id="loadBtn">
                    <i class="fas fa-folder-open"></i>
                    <span>Load</span>
                </button>
                <button class="theme-toggle" id="themeToggle">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </header>

        <div class="main-content">
            <div class="editor-section">
                <div class="editor-container">
                    <textarea id="editor" class="editor" placeholder="Type or paste your text here..."></textarea>
                    <div class="highlight-container" id="highlightContainer"></div>
                    <div class="loading" id="loading" style="display: none;">
                        <div class="spinner"></div>
                    </div>
                </div>
                <div class="counts">
                    <div>Words: <span id="wordCount">0</span></div>
                    <div>Characters: <span id="charCount">0</span></div>
                </div>
            </div>

            <!-- Rolling Grammar Toolbar -->
            <div class="grammar-toolbar" id="grammarToolbar">
                <div class="grammar-toggle" id="grammarToggle">
                    <i class="fas fa-spell-check grammar-toggle-icon"></i>
                    <div class="grammar-score" id="grammarScore">100</div>
                </div>
                <div class="grammar-header">
                    <div class="grammar-title">Grammar & Style</div>
                </div>
                <ul class="issue-list" id="issueList">
                    <!-- Grammar issues will be listed here -->
                </ul>
            </div>
        </div>

        <div class="gpt-detection-section">
            <div class="gpt-detection-header">
                <div class="gpt-detection-title">AI Content Detection</div>
                <div class="gpt-score-container">
                    <div id="gptScore" class="gpt-low">0%</div>
                </div>
            </div>
            <div class="gpt-progress">
                <div class="gpt-progress-bar" id="gptProgressBar" style="width: 0%;"></div>
            </div>
            <div class="gpt-info">
                <span>Human-written</span>
                <span>AI-generated</span>
            </div>
        </div>

        <div class="popup" id="popup">
            <div class="popup-title">AI Content Detected</div>
            <div class="popup-content">
                This section shows characteristics typical of AI-generated text, such as overly formal language, predictable sentence structure, and lack of personal voice.
            </div>
        </div>
    </div>

    <!-- Save Modal -->
    <div class="modal-overlay" id="saveModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Save Note</div>
                <button class="modal-close" id="closeSaveModal">&times;</button>
            </div>
            <form class="save-form" id="saveForm">
                <div class="form-group">
                    <label for="noteTitle" class="form-label">Note Title</label>
                    <input type="text" id="noteTitle" class="form-input" placeholder="Enter a title for your note" required>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="cancelSave">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Load Modal -->
    <div class="modal-overlay" id="loadModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Saved Notes</div>
                <button class="modal-close" id="closeLoadModal">&times;</button>
            </div>
            <ul class="saved-notes-list" id="savedNotesList">
                <!-- Saved notes will be listed here -->
            </ul>
            <div class="modal-actions">
                <button type="button" class="btn btn-secondary" id="cancelLoad">Close</button>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const themeToggle = document.getElementById('themeToggle');
        const body = document.body;
        const toggleIcon = themeToggle.querySelector('i');
        const editor = document.getElementById('editor');
        const highlightContainer = document.getElementById('highlightContainer');
        const gptScore = document.getElementById('gptScore');
        const gptProgressBar = document.getElementById('gptProgressBar');
        const grammarScore = document.getElementById('grammarScore');
        const wordCount = document.getElementById('wordCount');
        const charCount = document.getElementById('charCount');
        const issueList = document.getElementById('issueList');
        const popup = document.getElementById('popup');
        const loading = document.getElementById('loading');
        const grammarToolbar = document.getElementById('grammarToolbar');
        const grammarToggle = document.getElementById('grammarToggle');
        
        // Save/Load elements
        const saveBtn = document.getElementById('saveBtn');
        const loadBtn = document.getElementById('loadBtn');
        const saveModal = document.getElementById('saveModal');
        const loadModal = document.getElementById('loadModal');
        const closeSaveModal = document.getElementById('closeSaveModal');
        const closeLoadModal = document.getElementById('closeLoadModal');
        const cancelSave = document.getElementById('cancelSave');
        const cancelLoad = document.getElementById('cancelLoad');
        const saveForm = document.getElementById('saveForm');
        const noteTitle = document.getElementById('noteTitle');
        const savedNotesList = document.getElementById('savedNotesList');

        // Grammar toolbar toggle
        grammarToggle.addEventListener('click', () => {
            grammarToolbar.classList.toggle('open');
        });

        // Theme toggle functionality
        themeToggle.addEventListener('click', () => {
            body.classList.toggle('dark-mode');
            
            if (body.classList.contains('dark-mode')) {
                toggleIcon.classList.remove('fa-moon');
                toggleIcon.classList.add('fa-sun');
                try {
                    document.cookie = "theme=dark; path=/; max-age=31536000"; // 1 year
                } catch (e) {
                    console.error("Could not set theme cookie:", e);
                }
            } else {
                toggleIcon.classList.remove('fa-sun');
                toggleIcon.classList.add('fa-moon');
                try {
                    document.cookie = "theme=light; path=/; max-age=31536000";
                } catch (e) {
                    console.error("Could not set theme cookie:", e);
                }
            }
        });

        // Check for saved theme in cookies
        function getCookie(name) {
            try {
                const value = `; ${document.cookie}`;
                const parts = value.split(`; ${name}=`);
                if (parts.length === 2) return parts.pop().split(';').shift();
                return null;
            } catch (e) {
                console.error("Error reading cookie:", e);
                return null;
            }
        }

        try {
            const savedTheme = getCookie('theme');
            if (savedTheme === 'dark') {
                body.classList.add('dark-mode');
                toggleIcon.classList.remove('fa-moon');
                toggleIcon.classList.add('fa-sun');
            }
        } catch (e) {
            console.error("Error reading theme cookie:", e);
        }

        // Set initial height to match textarea
        highlightContainer.style.height = `${editor.offsetHeight}px`;

        let typingTimer;
        const typingInterval = 500; // Wait time after typing stops

        editor.addEventListener('input', () => {
            clearTimeout(typingTimer);
            
            // Update word count and character count immediately
            updateCounts();
            
            // Show loading state
            loading.style.display = 'flex';
            
            // Start analysis after typing stops
            typingTimer = setTimeout(() => {
                analyzeText();
            }, typingInterval);
        });

        // Ensure highlight container scrolls with textarea
        editor.addEventListener('scroll', () => {
            highlightContainer.scrollTop = editor.scrollTop;
            highlightContainer.scrollLeft = editor.scrollLeft;
        });

        // Handle mouse over highlighted text
        highlightContainer.addEventListener('mouseover', (e) => {
            if (e.target.classList.contains('gpt-highlight')) {
                showPopup(e.target);
            }
        });

        highlightContainer.addEventListener('mouseout', () => {
            popup.classList.remove('visible');
        });

        function updateCounts() {
            const text = editor.value;
            // Word count
            const words = text.trim() === '' ? 0 : text.trim().split(/\s+/).length;
            wordCount.textContent = words;
            // Character count
            charCount.textContent = text.length;
        }

        function analyzeText() {
            const text = editor.value;
            
            if (text.trim() === '') {
                // Reset all stats and highlights
                updateGptScore(0);
                updateGrammarScore(100);
                highlightContainer.innerHTML = '';
                issueList.innerHTML = '<li class="issue-item"><i class="fas fa-check-circle issue-icon" style="color: var(--success)"></i><span class="issue-text">No grammar issues found!</span></li>';
                loading.style.display = 'none';
                return;
            }

            // Simulate API call for GPT detection
            setTimeout(() => {
                const gptPercentage = simulateGptDetection(text);
                const grammarIssues = checkGrammar(text);
                
                // Update GPT score
                updateGptScore(gptPercentage);
                
                // Update grammar score
                const grammarPercentage = 100 - (grammarIssues.length * 5);
                updateGrammarScore(Math.max(0, grammarPercentage));
                
                // Apply highlights
                applyHighlights(text, gptPercentage, grammarIssues);
                
                // Update issue list
                updateIssueList(grammarIssues);
                
                // Open grammar toolbar if there are issues
                if (grammarIssues.length > 0) {
                    grammarToolbar.classList.add('open');
                }
                
                // Hide loading state
                loading.style.display = 'none';
            }, 600);
        }

        function updateGptScore(score) {
            gptScore.textContent = `${score}%`;
            gptProgressBar.style.width = `${score}%`;
            
            // Set color based on score
            g
